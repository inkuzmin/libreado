// Generated by CoffeeScript 1.7.1
(function() {
  define(["jquery", "lodash", "backbone", "modernizr", "routers/app", "typekit", "css!assets/styles/normalize.css"], function($, _, Backbone, Modernizr, AppRouter, typekit) {
    var checkLogin, init, initRouter, runApp;
    init = function() {
      try {
        typekit.load();
      } catch (_error) {}
      return checkLogin(runApp);
    };
    initRouter = function() {
      var lang, router;
      router = new AppRouter;
      lang = $("html").attr("lang");
      Backbone.history.start({
        pushState: true,
        root: "/" + lang
      });
      $(document).on("click", "a:not([data-bypass])", function(e) {
        var href, protocol;
        href = $(this).attr("href");
        protocol = this.protocol + "//";
        if (href.slice(protocol.length) !== protocol) {
          e.preventDefault();
          return router.navigate(href.replace("..", ""), true);
        }
      });
      return router;
    };
    checkLogin = function(callback) {
      return $.ajax("/account/authenticated", {
        method: "GET",
        success: function() {
          return callback(true);
        },
        error: function(data) {
          return callback(false);
        }
      });
    };
    runApp = function(isAuthenticated) {
      var router;
      router = initRouter();
      if (isAuthenticated) {
        return router.navigate("index", true);
      } else {
        return router.navigate("welcome/login", true);
      }
    };
    return _.extend({}, {
      init: init
    });
  });

}).call(this);

//# sourceMappingURL=app.map
